{"title": "Run the Trap! How to Setup your own Honeypot to collect Malware samples - Malware - 0x00sec - The Home of the Hacker", "users": ["http://0x00sec.org/u/REal0day", "http://0x00sec.org/u/pry0cc", "http://0x00sec.org/u/gawisec", "http://0x00sec.org/u/Evalion", "http://0x00sec.org/u/lkw", "http://0x00sec.org/u/sergeantsploit", "http://0x00sec.org/u/purana", "http://0x00sec.org/u/REal0day", "http://0x00sec.org/u/REal0day", "http://0x00sec.org/u/Techno_Forg", "http://0x00sec.org/u/pry0cc", "http://0x00sec.org/u/skidd0", "http://0x00sec.org/u/REal0day", "http://0x00sec.org/u/REal0day", "http://0x00sec.org/u/FinFlag", "http://0x00sec.org/u/Techno_Forg", "http://0x00sec.org/u/pry0cc", "http://0x00sec.org/u/MLogan", "http://0x00sec.org/u/dtwozero", "http://0x00sec.org/u/FinFlag"], "data": [{"author": "REal0day", "speak": "IntroductionThis paper is how to setup your own Honeypot (dionaea). I would say most of us like Reverse Engineering binaries. Many of us have a fascination with malware. Why not combine them and RE some Malware that\u00e2\u20ac\u2122s actively being used for exploitation?My tutorial is how to setup a honeypot on Amazon Web Services (AWS). If you\u00e2\u20ac\u2122re unfamiliar with AWS, tldr; they have servers, you can use them. ProTip: If you have 1 micro-instance with an attached hard drive less than 50GB, you can have a free server. You will have to provide your credit card info to AWS, but you are allowed a free server forever, so long as you stay in the \u00e2\u20ac\u0153free-tier\u00e2\u20ac\ufffd. Now, you\u00e2\u20ac\u2122re able to spin up n-number of micro-instances, but you only get what is equated to 1 month amount of hours, each month. So if you spin up 2 micro-instances, half way through the money, you will start to be billed, till the end of the month. So be careful.Author Level: SkiddoRequired SkillsGeneral Linux CommandsGeneral Understanding of NetworksRequirementsServer (AWS works well. Free w/ CC provided)Disclaimer (Optional)Some hosting providers don\u00e2\u20ac\u2122t like malware.So like, maybe not collect on their servers if they aren\u00e2\u20ac\u2122t cool like you.(Separate this header from the paper using a horizontal rule)The paperAWS setupI will now begin how to setup your AWS instance.[If you are not using AWS, skip to the next section.]Go ahead a click EC2 and Create a new Instance. (EC2 == AWS Servers). After that, you want to select Ubuntu Server 14.04 LTSScreen Shot 2018-06-11 at 5.42.20 PM.png1292x528 83.5 KBNext, select the micro-instance type.Screen Shot 2018-06-11 at 5.42.36 PM.png1317x709 109 KBGreat, now for Configure Instance Details, select \u00e2\u20ac\u0153Auto-assign Public IP\u00e2\u20ac\ufffd and set it to \u00e2\u20ac\u0153Enable\u00e2\u20ac\ufffd. (Don\u00e2\u20ac\u2122t worry about my IAM role)Screen Shot 2018-06-11 at 5.43.33 PM.png1320x741 100 KBFor storage, just add the default and click Next.Ignore adding Tags and click Next.Configuring Security Group is a bit more in depth. AWS by default only allows SSH open for your server. You must change this and all ALL ports open to your server. Yes. This is more insecure, but that\u00e2\u20ac\u2122s the point.Screen Shot 2018-06-11 at 5.44.53 PM.png1322x738 114 KBLaunch!Screen Shot 2018-06-11 at 5.45.40 PM.png1313x736 96.9 KBAlright this part is a bit more complex. To SSH into your box, you have to change the permissions for your private key (something.pem), and then ssh using it. Get your hostname from your instance. It\u00e2\u20ac\u2122ll be under Public DNS (IPv4 )Screen Shot 2018-06-11 at 5.46.23 PM.png1112x512 45.8 KBEnter these on your local to connect to you AWS Server.$ sudo chmod 400 /home/user/Downloads/key.pem$ ssh -i /home/user/Downloads/key.pem ubuntu@ec2-13-57-45-50.us-west-1.compute.amaonaws.comServer setupLet\u00e2\u20ac\u2122s do our due diligence like good admins.$ sudo su# apt-get update; apt-get upgrade -y; apt-get dist-upgrade;Grab out dependencies# apt-get install git -y# git clone https://github.com/DinoTools/dionaea# apt-get install build-essential cmake check cython3 libcurl4-openssl-dev libemu-dev libev-dev libglib2.0-dev libloudmouth1-dev libnetfilter-queue-dev libnl-3-dev libpcap-dev libssl-dev libtool libudns-dev python3 python3-dev python3-bson python3-yaml ttf-liberation# mkdir build# cd build# cmake -DCMAKE_INSTALL_PREFIX:PATH=/opt/dionaea \u00e2\u20ac\u00a6# make# make install# cd /opt/dionaea/Alright, now this is where you configuration file is. dionaea.cfgThis file specifies where your malware/binaries will get dropped, interface and ports listening. You can leave these default, but remember, the log file WILL get big. I think I had about 1G of malware, and 19G in logs.Screen Shot 2018-07-08 at 4.06.29 AM.png914x452 37.9 KBSo dionaea has many different services that it can allow and thus, making your honeypot open to more types of attacks. You get more malware.These settings can be toggled in the services-available and services-enableddirectories. By editing each yaml file, you edit the service and how it will appear to a hacker/bot. If you want to accept SMB attacks, like\u00e2\u20ac\u00a6WannaCry, you\u00e2\u20ac\u2122re gonna want to setup your server to accept smb.# vim services-enabled/smb.yamlIf you want to enable a default Windows 7 setup, just uncomment Win7. Feel free to get creative.Screen Shot 2018-06-11 at 5.55.51 PM.png761x427 29.2 KBLast but never least\u00e2\u20ac\u00a6RUN THE TRAP!!!# /opt/dionaea/bin/dionaea -DScreen Shot 2018-06-11 at 5.56.50 PM.png760x293 37.3 KBConclusionsTook me awhile to get this up and running my first time. Second time, it took 16 minutes. If you\u00e2\u20ac\u2122re having difficulties, try their docs.https://dionaea.readthedocs.io/en/latest/run.htmlAlso just bug me on IRC.See you on there. <3"}, {"author": "pry0cc", "speak": "I want to set this up with Google cloud with a packer image.Hopefully we can introduce the magic of DevOps through this @fraqAnyway, good job dude! Nice article"}, {"author": "gawisec", "speak": "How does malware discover the server and by what means?"}, {"author": "Evalion", "speak": "One possibility I can think of is that it scans different IP ranges and then tries automated exploits on them."}, {"author": "lkw", "speak": "In addition to what @Evalion suggested, if the server gets indexed in Shodan it could be discovered through Shodan\u00e2\u20ac\u2122s API. E.g. see autosploit"}, {"author": "sergeantsploit", "speak": "Github Repo 404. Check it out."}, {"author": "purana", "speak": "sergeantsploit:Github Repo 404. Check it out.Looks to be a typo in the article for the github link\u00e2\u20ac\u00a6 Try this one here instead.https://github.com/DinoTools"}, {"author": "REal0day", "speak": "Thanks! Changed it so it should work now."}, {"author": "REal0day", "speak": "These are all correct. This is how one discovers your vuln server.Scanning IPs, fingerprinting, and then (usually) auto-executing an exploit and dropping malware on your server."}, {"author": "Techno_Forg", "speak": "Interesting\u00e2\u20ac\u00a6 now what to do if you don\u00e2\u20ac\u2122t have a CC (and not for the lack of trying)?"}, {"author": "pry0cc", "speak": "CC? Credit card?Don\u00e2\u20ac\u2122t use a VPS then. Portforward it like a maniac."}, {"author": "skidd0", "speak": "REal0day:Author Level: SkiddoHey! I guess I\u00e2\u20ac\u2122m a unit of measurement. That\u00e2\u20ac\u2122s cool."}, {"author": "REal0day", "speak": "The BEST unit of measurement."}, {"author": "REal0day", "speak": "Could set it up at home, but I\u00e2\u20ac\u2122m not sure the safest way of doing this. Much iptable rules."}, {"author": "FinFlag", "speak": "Would be extremely careful with setting up honeypot on home network. Couple thoughts would be to make sure your honeypot is an isolated vlan on a dd-wrt router. Set it on the home dmz with firewall behind it to allow not traffic into the network from it."}, {"author": "Techno_Forg", "speak": "I will look into it\u00e2\u20ac\u00a6 doubt I will come up with much though 'cuz I\u00e2\u20ac\u2122m just a scrub. lololol."}, {"author": "pry0cc", "speak": "This is why you should use a VPS. Much simpler."}, {"author": "MLogan", "speak": "Set mine up and it had 23GB of log file within 10 minutes of running\u00e2\u20ac\u00a6Restarted with a different log level set"}, {"author": "dtwozero", "speak": "i like this post. although i\u00e2\u20ac\u2122m not a fan of aws ec2 instances. i apreciate this post. i\u00e2\u20ac\u2122m going to give this a try on my linode or digitalocean vps. I\u00e2\u20ac\u2122ve alsways wanted to see what i could collect."}, {"author": "FinFlag", "speak": "I am 100% in agreement with you. For purposes of malware research, a vps is the best. Honeypots internally are not bad defense for companies. I think of it as alarm system on your network. As for home users, I wouldn\u00e2\u20ac\u2122t encourage it as much."}]}